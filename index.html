<script>
  // --- Core game variables ---
  let points = 0;
  let passiveGain = 1;
  let flatBonus = 0;
  let bTier = 0;
  let nextBThreshold = 500;

  let upgrade1Cost = 50;
  let upgrade2Cost = 1500;
  let upgrade3Cost = 10000;
  let upgrade3Count = 0;
  let baseMultiplier = 2.0;

  // DOM elements
  const pointsEl = document.getElementById("points");
  const passiveRateEl = document.getElementById("passiveRate");
  const baseMultEl = document.getElementById("baseMult");
  const bTierEl = document.getElementById("bTier");
  const bNextEl = document.getElementById("bNext");

  const upgrade1Btn = document.getElementById("upgrade1Btn");
  const upgrade2Btn = document.getElementById("upgrade2Btn");
  const upgrade3Btn = document.getElementById("upgrade3Btn");
  const bResetBtn = document.getElementById("bResetBtn");
  const quitBtn = document.getElementById("quitBtn");
  const bInfoBtn = document.getElementById("bInfoBtn");
  const saveBtn = document.getElementById("saveBtn");
  const clearBtn = document.getElementById("clearBtn");

  const cost1Display = document.getElementById("cost1Display");
  const cost2Display = document.getElementById("cost2Display");
  const cost3Display = document.getElementById("cost3Display");
  const upgrade1Section = document.getElementById("upgrade1Section");
  const upgrade2Section = document.getElementById("upgrade2Section");
  const upgrade3Section = document.getElementById("upgrade3Section");

  // --- UI Update ---
  function updateUI() {
    pointsEl.textContent = Math.floor(points);
    passiveRateEl.textContent = (passiveGain + flatBonus).toFixed(2);
    baseMultEl.textContent = baseMultiplier.toFixed(1);
    bTierEl.textContent = bTier;
    bNextEl.textContent = nextBThreshold.toLocaleString();

    if (bTier >= 0) upgrade1Section.classList.remove("hidden");
    if (bTier >= 2) {
      upgrade2Section.classList.remove("hidden");
      cost2Display.textContent = `Cost: ${upgrade2Cost}`;
    } else upgrade2Section.classList.add("hidden");
    if (bTier >= 3) {
      upgrade3Section.classList.remove("hidden");
      cost3Display.textContent = `Cost: ${upgrade3Cost}`;
    } else upgrade3Section.classList.add("hidden");

    cost1Display.textContent = `Cost: ${upgrade1Cost}`;
    upgrade1Btn.disabled = points < upgrade1Cost;
    upgrade2Btn.disabled = points < upgrade2Cost;
    upgrade3Btn.disabled = points < upgrade3Cost;
    bResetBtn.disabled = points < nextBThreshold;
  }

  // --- Save System ---
  function saveGame() {
    const data = {
      points,
      passiveGain,
      flatBonus,
      bTier,
      nextBThreshold,
      upgrade1Cost,
      upgrade2Cost,
      upgrade3Cost,
      upgrade3Count,
      baseMultiplier
    };
    localStorage.setItem("miniGameSave", JSON.stringify(data));
    console.log("ðŸ’¾ Game saved:", data);
  }

  function loadGame() {
    const save = localStorage.getItem("miniGameSave");
    if (!save) return;
    const data = JSON.parse(save);
    Object.assign(window, data);
    console.log("âœ… Game loaded:", data);
  }

  function clearSave() {
    localStorage.removeItem("miniGameSave");
    console.log("ðŸ—‘ï¸ Save cleared!");
  }

  // --- Upgrades ---
  upgrade1Btn.addEventListener("click", () => {
    if (points >= upgrade1Cost) {
      points -= upgrade1Cost;
      passiveGain *= baseMultiplier;
      upgrade1Cost = Math.floor(upgrade1Cost * (2 + 0.2 * bTier));
      updateUI();
      saveGame();
    }
  });

  upgrade2Btn.addEventListener("click", () => {
    if (points >= upgrade2Cost && bTier >= 2) {
      points -= upgrade2Cost;
      flatBonus += 10 + bTier * 5;
      upgrade2Cost = Math.floor(upgrade2Cost * (2.5 + 0.25 * bTier));
      updateUI();
      saveGame();
    }
  });

  upgrade3Btn.addEventListener("click", () => {
    if (points >= upgrade3Cost && bTier >= 3) {
      points -= upgrade3Cost;
      upgrade3Count++;
      baseMultiplier += 0.1;
      upgrade3Cost = Math.floor(upgrade3Cost * (3 + 0.3 * bTier));
      updateUI();
      saveGame();
    }
  });

  // --- B-tier Reset ---
  bResetBtn.addEventListener("click", () => {
    if (points >= nextBThreshold) {
      bTier++;
      points = 0;
      passiveGain = Math.pow(2.5, bTier);
      flatBonus = 0;
      baseMultiplier = 2.0 + 0.1 * upgrade3Count;
      upgrade1Cost = 50;
      upgrade2Cost = 1500;
      upgrade3Cost = 10000;
      nextBThreshold = Math.floor(500 * Math.pow(4.5, bTier));
      updateUI();
      saveGame();
      alert(`ðŸŽ‰ B-tier reset complete! Youâ€™re now Tier ${bTier}`);
    }
  });

  // --- Buttons ---
  quitBtn.addEventListener("click", () => {
    alert(`Game over! Final A: ${points}, B-tier resets: ${bTier}`);
    clearSave();
    resetGame();
  });

  bInfoBtn.addEventListener("click", () => {
    saveGame(); // ðŸ”¥ ensures latest data is stored before redirect
    window.location.href = "btier.html";
  });

  saveBtn?.addEventListener("click", saveGame);
  clearBtn?.addEventListener("click", clearSave);

  function resetGame() {
    points = 0;
    passiveGain = 1;
    flatBonus = 0;
    bTier = 0;
    upgrade3Count = 0;
    baseMultiplier = 2.0;
    nextBThreshold = 500;
    upgrade1Cost = 50;
    upgrade2Cost = 1500;
    upgrade3Cost = 10000;
    updateUI();
    saveGame();
  }

  // --- Passive loop ---
  setInterval(() => {
    points += (passiveGain + flatBonus);
    updateUI();
  }, 1000);

  // --- Auto-save ---
  setInterval(saveGame, 5000);

  // --- Init ---
  loadGame();
  updateUI();
</script>



